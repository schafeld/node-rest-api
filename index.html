<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Items Store Manager - REST API Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 0;
            min-height: 600px;
        }

        .items-section {
            padding: 30px;
            border-right: 1px solid #e1e5e9;
        }

        .form-section {
            padding: 30px;
            background: #f8f9fa;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .items-list {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .item-card {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .item-card:hover {
            background-color: #f8f9fa;
        }

        .item-card:last-child {
            border-bottom: none;
        }

        .item-card.out-of-stock {
            background-color: #fff5f5;
            border-left: 4px solid #dc3545;
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .item-details {
            color: #666;
            font-size: 0.9rem;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-check input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .status-indicator {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-in-stock {
            background: #d1e7dd;
            color: #0f5132;
        }

        .status-out-of-stock {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .alert-success {
            background: #d1e7dd;
            color: #0f5132;
            border: 1px solid #badbcc;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .items-section {
                border-right: none;
                border-bottom: 1px solid #e1e5e9;
            }
            
            .controls {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ Items Store Manager</h1>
            <p>REST API Demo Application - Manage your inventory with full CRUD operations</p>
        </div>

        <div class="main-content">
            <div class="items-section">
                <div class="section-title">
                    üì¶ Items Inventory
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalItems">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="inStockItems">0</div>
                        <div class="stat-label">In Stock</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="outOfStockItems">0</div>
                        <div class="stat-label">Out of Stock</div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-primary" onclick="loadItems()">
                        üîÑ Refresh
                    </button>
                    <button class="btn btn-success" onclick="showAddForm()">
                        ‚ûï Add Item
                    </button>
                    <button class="btn btn-danger" onclick="resetToDefault()">
                        üîß Reset to Default
                    </button>
                </div>

                <div class="alert alert-success" id="successAlert"></div>
                <div class="alert alert-danger" id="errorAlert"></div>

                <div class="items-list" id="itemsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading items...
                    </div>
                </div>
            </div>

            <div class="form-section">
                <div class="section-title">
                    ‚úèÔ∏è Item Form
                </div>

                <form id="itemForm">
                    <input type="hidden" id="itemId">
                    
                    <div class="form-group">
                        <label class="form-label" for="itemName">Name *</label>
                        <input type="text" class="form-control" id="itemName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="itemCategory">Category *</label>
                        <select class="form-control" id="itemCategory" required>
                            <option value="">Select category...</option>
                            <option value="Fruit">Fruit</option>
                            <option value="Vegetable">Vegetable</option>
                            <option value="Dairy">Dairy</option>
                            <option value="Bakery">Bakery</option>
                            <option value="Beverage">Beverage</option>
                            <option value="Snack">Snack</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="itemPrice">Price ($) *</label>
                        <input type="number" class="form-control" id="itemPrice" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <div class="form-check">
                            <input type="checkbox" id="itemInStock" checked>
                            <label class="form-label" for="itemInStock">In Stock</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn btn-success" id="submitBtn">
                            ‚ûï Add Item
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="cancelEdit()" id="cancelBtn" style="display: none;">
                            ‚ùå Cancel
                        </button>
                    </div>
                </form>

                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                    <h4>üîß API Information</h4>
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.5;">
                        This demo application connects to your REST API server running on 
                        <strong>http://localhost:3000</strong>. Make sure the server is running 
                        before using this interface.
                    </p>
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-top: 10px;">
                        <strong>Supported operations:</strong><br>
                        ‚Ä¢ GET - View all items<br>
                        ‚Ä¢ POST - Create new items<br>
                        ‚Ä¢ PUT - Update existing items<br>
                        ‚Ä¢ DELETE - Remove items<br>
                        ‚Ä¢ Reset - Restore original data
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        let editingItemId = null;

        // Load items on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadItems();
        });

        // Form submission handler
        document.getElementById('itemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (editingItemId) {
                updateItem();
            } else {
                createItem();
            }
        });

        // Load all items from API
        async function loadItems() {
            try {
                showLoading();
                const response = await fetch(`${API_BASE}/items`, {
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                displayItems(data.items || []);
                updateStats(data.items || []);
                hideAlert();
            } catch (error) {
                console.error('Error loading items:', error);
                showAlert(`Failed to load items: ${error.message}`, 'error');
                document.getElementById('itemsList').innerHTML = 
                    '<div style="text-align: center; padding: 40px; color: #dc3545;">‚ö†Ô∏è Failed to load items. Is the server running?</div>';
            }
        }

        // Display items in the list
        function displayItems(items) {
            const itemsList = document.getElementById('itemsList');
            
            if (items.length === 0) {
                itemsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">üì≠ No items found</div>';
                return;
            }

            const itemsHTML = items.map(item => `
                <div class="item-card ${!item.inStock ? 'out-of-stock' : ''}">
                    <div class="item-info">
                        <div class="item-name">${escapeHtml(item.name)}</div>
                        <div class="item-details">
                            <strong>Category:</strong> ${escapeHtml(item.category)} | 
                            <strong>Price:</strong> $${item.price.toFixed(2)} | 
                            <span class="status-indicator ${item.inStock ? 'status-in-stock' : 'status-out-of-stock'}">
                                ${item.inStock ? '‚úÖ In Stock' : '‚ùå Out of Stock'}
                            </span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-warning btn-sm" onclick="editItem(${item.id})">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id}, '${escapeHtml(item.name)}')">
                            üóëÔ∏è Delete
                        </button>
                    </div>
                </div>
            `).join('');

            itemsList.innerHTML = itemsHTML;
        }

        // Update statistics
        function updateStats(items) {
            const totalItems = items.length;
            const inStockItems = items.filter(item => item.inStock).length;
            const outOfStockItems = totalItems - inStockItems;

            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('inStockItems').textContent = inStockItems;
            document.getElementById('outOfStockItems').textContent = outOfStockItems;
        }

        // Create new item
        async function createItem() {
            const itemData = {
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                inStock: document.getElementById('itemInStock').checked
            };

            try {
                const response = await fetch(`${API_BASE}/items`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(itemData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }

                const result = await response.json();
                showAlert(`Item "${result.item.name}" created successfully!`, 'success');
                clearForm();
                loadItems();
            } catch (error) {
                console.error('Error creating item:', error);
                showAlert(`Failed to create item: ${error.message}`, 'error');
            }
        }

        // Edit item
        async function editItem(itemId) {
            try {
                const response = await fetch(`${API_BASE}/items/${itemId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                const item = data.item;

                // Fill form with item data
                document.getElementById('itemId').value = item.id;
                document.getElementById('itemName').value = item.name;
                document.getElementById('itemCategory').value = item.category;
                document.getElementById('itemPrice').value = item.price;
                document.getElementById('itemInStock').checked = item.inStock;

                // Update form UI
                editingItemId = itemId;
                document.getElementById('submitBtn').innerHTML = 'üíæ Update Item';
                document.getElementById('cancelBtn').style.display = 'inline-block';
                document.querySelector('.section-title').innerHTML = '‚úèÔ∏è Edit Item';

                // Scroll to form
                document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error loading item for edit:', error);
                showAlert(`Failed to load item: ${error.message}`, 'error');
            }
        }

        // Update existing item
        async function updateItem() {
            const itemData = {
                name: document.getElementById('itemName').value,
                category: document.getElementById('itemCategory').value,
                price: parseFloat(document.getElementById('itemPrice').value),
                inStock: document.getElementById('itemInStock').checked
            };

            try {
                const response = await fetch(`${API_BASE}/items/${editingItemId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(itemData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }

                const result = await response.json();
                showAlert(`Item "${result.item.name}" updated successfully!`, 'success');
                cancelEdit();
                loadItems();
            } catch (error) {
                console.error('Error updating item:', error);
                showAlert(`Failed to update item: ${error.message}`, 'error');
            }
        }

        // Delete item
        async function deleteItem(itemId, itemName) {
            if (!confirm(`Are you sure you want to delete "${itemName}"?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/items/${itemId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }

                showAlert(`Item "${itemName}" deleted successfully!`, 'success');
                loadItems();
            } catch (error) {
                console.error('Error deleting item:', error);
                showAlert(`Failed to delete item: ${error.message}`, 'error');
            }
        }

        // Reset to default data
        async function resetToDefault() {
            if (!confirm('Are you sure you want to reset all data to the original items? This will delete all current items and restore the default set.')) {
                return;
            }

            try {
                // This is a custom endpoint we'll need to add to the server
                // For now, we'll simulate it by deleting all items and recreating defaults
                showAlert('Resetting to default data...', 'success');
                
                // Get current items
                const response = await fetch(`${API_BASE}/items`, {
                    headers: { 'Accept': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Delete all current items
                    for (const item of data.items || []) {
                        await fetch(`${API_BASE}/items/${item.id}`, { method: 'DELETE' });
                    }
                    
                    // Add default items
                    const defaultItems = [
                        { name: "Apple", category: "Fruit", price: 0.5, inStock: true },
                        { name: "Banana", category: "Fruit", price: 0.3, inStock: true },
                        { name: "Carrot", category: "Vegetable", price: 0.2, inStock: false },
                        { name: "Bread", category: "Bakery", price: 1.5, inStock: true },
                        { name: "Milk", category: "Dairy", price: 1.0, inStock: false }
                    ];
                    
                    for (const item of defaultItems) {
                        await fetch(`${API_BASE}/items`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(item)
                        });
                    }
                    
                    showAlert('Data reset to default successfully!', 'success');
                    loadItems();
                }
            } catch (error) {
                console.error('Error resetting data:', error);
                showAlert(`Failed to reset data: ${error.message}`, 'error');
            }
        }

        // Show add form
        function showAddForm() {
            cancelEdit();
            document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Cancel edit mode
        function cancelEdit() {
            editingItemId = null;
            clearForm();
            document.getElementById('submitBtn').innerHTML = '‚ûï Add Item';
            document.getElementById('cancelBtn').style.display = 'none';
            document.querySelector('.section-title').innerHTML = '‚úèÔ∏è Item Form';
        }

        // Clear form
        function clearForm() {
            document.getElementById('itemForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('itemInStock').checked = true;
        }

        // Show loading state
        function showLoading() {
            document.getElementById('itemsList').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Loading items...
                </div>
            `;
        }

        // Show alert message
        function showAlert(message, type = 'success') {
            const alertId = type === 'success' ? 'successAlert' : 'errorAlert';
            const alertElement = document.getElementById(alertId);
            
            // Hide other alert
            const otherAlert = type === 'success' ? 'errorAlert' : 'successAlert';
            document.getElementById(otherAlert).classList.remove('show');
            
            alertElement.textContent = message;
            alertElement.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                alertElement.classList.remove('show');
            }, 5000);
        }

        // Hide alerts
        function hideAlert() {
            document.getElementById('successAlert').classList.remove('show');
            document.getElementById('errorAlert').classList.remove('show');
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>